import sqlite3
import os
import time

# ì¹´ì¹´ì˜¤í†¡ DB ê²½ë¡œ (ì‚¬ìš©ì ê³„ì •ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
KAKAO_DB_PATH = os.path.expanduser(r'~\AppData\Local\Kakao\KakaoTalk\KakaoTalk.db')

def get_latest_kakao_message():
    """ì¹´ì¹´ì˜¤í†¡ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì¥ ìµœê·¼ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°"""
    if not os.path.exists(KAKAO_DB_PATH):
        print("âŒ ì¹´ì¹´ì˜¤í†¡ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return None

    try:
        # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
        conn = sqlite3.connect(KAKAO_DB_PATH)
        cursor = conn.cursor()

        # ê°€ì¥ ìµœê·¼ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
        cursor.execute("SELECT chat_id, user_id, message, created_at FROM chat_messages ORDER BY created_at DESC LIMIT 5")
        messages = cursor.fetchall()

        conn.close()

        return messages

    except Exception as e:
        print(f"âš ï¸ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None

if __name__ == "__main__":
    print("ğŸ“© ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ ê°ì§€ ì¤‘...")
    
    while True:
        latest_messages = get_latest_kakao_message()
        if latest_messages:
            for chat in latest_messages:
                chat_id, user_id, message, created_at = chat
                print(f"\nğŸ“ [ì±„íŒ… ID: {chat_id}] {user_id}: {message} (ì‹œê°„: {created_at})")
        
        time.sleep(5)  # 5ì´ˆë§ˆë‹¤ í™•ì¸
